<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Webhook Monitor</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h1 class="card-title text-center mb-4">GitHub Activity Monitor</h1>
                        <div id="status" class="text-center text-muted fst-italic mb-3">Loading events...</div>
                        <div id="events"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        function fetchEvents() {
            fetch('/webhook/events')
                .then(response => response.json())
                .then(data => {
                    const eventsDiv = document.getElementById('events');
                    const statusDiv = document.getElementById('status');
                    
                    if (data.events.length === 0) {
                        statusDiv.textContent = 'No events yet. Waiting for GitHub activity...';
                        eventsDiv.innerHTML = '';
                    } else {
                        statusDiv.textContent = `${data.events.length} recent events`;
                        eventsDiv.innerHTML = data.events.map(event => {
                            let alertClass = 'alert-primary';
                            let borderClass = 'border-primary';
                            let eventHtml = '';
                            
                            if (event.action === 'PUSH') {
                                alertClass = 'alert-success';
                                borderClass = 'border-success';
                                eventHtml = `<em>${event.author}</em> pushed to <em>${event.to_branch}</em> on <em>${event.timestamp}</em>`;
                            } else if (event.action === 'PULL_REQUEST') {
                                alertClass = 'alert-warning';
                                borderClass = 'border-warning';
                                eventHtml = `<em>${event.author}</em> submitted a pull request from <em>${event.from_branch}</em> to <em>${event.to_branch}</em> on <em>${event.timestamp}</em>`;
                            } else if (event.action === 'MERGE') {
                                alertClass = 'alert-danger';
                                borderClass = 'border-danger';
                                eventHtml = `<em>${event.author}</em> merged branch <em>${event.from_branch}</em> to <em>${event.to_branch}</em> on <em>${event.timestamp}</em>`;
                            }
                            
                            return `
                                <div class="alert ${alertClass} ${borderClass} border-start border-4 mb-3">
                                    ${eventHtml}
                                </div>
                            `;
                        }).join('');
                    }
                })
                .catch(error => {
                    console.error('Error fetching events:', error);
                    document.getElementById('status').textContent = 'Error loading events';
                });
        }

        // Fetch events immediately and then every 15 seconds
        fetchEvents();
        setInterval(fetchEvents, 15000);
    </script></body>
</html>
